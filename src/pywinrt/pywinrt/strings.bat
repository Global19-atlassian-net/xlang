@echo off
setlocal enabledelayedexpansion

set INPUT_DIR="%~1"
set STRINGS_HEADER="%~2"
set STRINGS_CPP="%~3"

:: Generate the header file
echo // This file was generated by strings.bat  > %STRINGS_HEADER%
echo ^#pragma once >> %STRINGS_HEADER%
echo namespace strings ^{ >> %STRINGS_HEADER%

echo // This file was generated by strings.bat  > %STRINGS_CPP%
echo ^#include "pch.h" >> %STRINGS_CPP%
echo ^#include "strings.h" >> %STRINGS_CPP%

for %%f in (%INPUT_DIR%\*) do (
    echo "Processing %%f - %%~zf bytes"
    :: account for null terminator
    SET /A s=%%~zf+1
    echo extern char const %%~Nf^[!s!^]; >> %STRINGS_HEADER%
    echo |set /p=extern^ char^ const^ strings^:^:%%~Nf^[^]=>> %STRINGS_CPP%
    type decl_prefix.txt >> %STRINGS_CPP%
    type %%f >> %STRINGS_CPP%
    echo ^)xyz^"^; >> %STRINGS_CPP%

)

echo ^} >> %STRINGS_HEADER%
